name : MDO detection with Email Malware
description : 
- These queries are going to hunt for - Malware mails with Microsoft Defender for Office 365
- Case1 - MDO detection list 
- Case2 - Filter MDO detection based on detection methods
table : 
- EmailEvents
- https://learn.microsoft.com/en-us/microsoft-365/security/defender/advanced-hunting-emailevents-table?view=o365-worldwide
query : |
    //Case1 - MDO detection list
    EmailEvents
    | where Timestamp > ago(7d)
    | where isnotempty(DetectionMethods)
    | extend MDO_detection = parse_json(DetectionMethods)
    | where MDO_detection.Malware in 
      (
       @'["File detonation"]',
       @'["File detonation reputation"]',
       @'["URL detonation"]',
       @'["URL detonation reputation"]',
       @'["Campaign"]'
      )
    | project Timestamp, Subject, NetworkMessageId, SenderFromAddress, RecipientEmailAddress, DeliveryLocation, MDO_detection.Malware


    //Case2 - Filter MDO detection based on detection methods
    EmailEvents
    | where Timestamp > ago(7d)
    | where isnotempty(DetectionMethods)
    | extend MDO_detection = parse_json(DetectionMethods)
    | where MDO_detection.Malware == @'["File detonation"]'
    //| where MDO_detection.Malware == @'["File detonation reputation"]'
    //| where MDO_detection.Malware == @'["URL detonation"]'
    //| where MDO_detection.Malware == @'["URL detonation reputation"]'
    //| where MDO_detection.Malware == @'["Campaign"]'
    | project Timestamp, Subject, NetworkMessageId, SenderFromAddress, RecipientEmailAddress, DeliveryLocation, MDO_detection.Malware

